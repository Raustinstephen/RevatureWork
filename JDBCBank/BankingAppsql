CREATE TABLE UserTable (
USER_ID NUMBER NOT NULL,
USERNAME VARCHAR2(100),
PASSENCRYPT NUMBER NOT NULL,
USER_TYPE NUMBER NOT NULL,
CONSTRAINT PK_USER PRIMARY KEY (USER_ID)
);

CREATE TABLE Applicants (
APP_ID NUMBER NOT NULL,
USERNAME VARCHAR2(100),
PASSENCRYPT NUMBER NOT NULL,
ACCEPTED VARCHAR2(50),
DENIED VARCHAR2(50),
CONSTRAINT PK_APP PRIMARY KEY (APP_ID)
);

CREATE TABLE UserInfo (
USER_ID NUMBER NOT NULL,
FIRSTNAME VARCHAR2(100),
LASTNAME VARCHAR2(100),
ADDRESS VARCHAR2(100),
CITY VARCHAR2(100),
STATE_LOC VARCHAR2(20),
PHONE VARCHAR2(12),
EMAIL VARCHAR2(100),
CONSTRAINT PK_USERINFO PRIMARY KEY (USER_ID)
);

CREATE TABLE Accounts (
ACC_ID NUMBER NOT NULL,
BALANCE NUMBER NOT NULL,
USER_ID NUMBER NOT NULL,
CONSTRAINT PK_ACC PRIMARY KEY (ACC_ID)
);

/*******************************************************************************
   Create Foreign Keys
********************************************************************************/
ALTER TABLE Accounts ADD CONSTRAINT FK_UserTableUserId
    FOREIGN KEY (USER_ID) REFERENCES UserTable (USER_ID)  ;
    
ALTER TABLE UserInfo ADD CONSTRAINT FK_UserInfoUserId
    FOREIGN KEY (USER_ID) REFERENCES UserTable (USER_ID)  ;



CREATE SEQUENCE ADDUSERSEQ
MINVALUE 10000
MAXVALUE 1000000
START WITH 10000
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE ADDAPPLICANTSEQ
MINVALUE 1000
MAXVALUE 1000000
START WITH 1000
INCREMENT BY 1
CACHE 20;

CREATE SEQUENCE ADDACCOUNTSEQ
MINVALUE 100
MAXVALUE 1000000
START WITH 100
INCREMENT BY 1
CACHE 20;


INSERT INTO UserTable VALUES (ADDUSERSEQ.NEXTVAL, 'Admin',787578,3);
INSERT INTO UserInfo VALUES (10000, 'Admin','Account','123 Financial Ave','Tampa','FL','555-555-5555','admin@ucfbank.com');
INSERT INTO UserTable VALUES (ADDUSERSEQ.NEXTVAL, 'Admin',787578,3);
INSERT INTO UserInfo VALUES (10001, 'Admin2','Account','123 Financial Ave','Tampa','FL','555-555-5555','admin2@ucfbank.com');


SELECT * FROM USERINFO WHERE USER_ID =10001;
commit;

SELECT * FROM USERTABLE WHERE USERNAME = austin;

UPDATE USERTABLE
SET USERNAME = 'ADMIN2'
WHERE USER_ID=10001;

ALTER TABLE USERTABLE ADD CONSTRAINT UNIQ_USERNAME UNIQUE (USERNAME);

COMMIT;

CREATE OR REPLACE PROCEDURE CREATEUSER (
I_USERNAME IN USERTABLE.USERNAME%TYPE,
I_PASSENCRYPT IN USERTABLE.PASSENCRYPT%TYPE,
I_USER_TYPE IN USERTABLE.USER_TYPE%TYPE,
I_FIRSTNAME IN USERINFO.FIRSTNAME%TYPE,
I_LASTNAME IN USERINFO.LASTNAME%TYPE,
I_ADDRESS IN USERINFO.ADDRESS%TYPE,
I_CITY IN USERINFO.CITY%TYPE,
I_STATE_LOC IN USERINFO.STATE_LOC%TYPE,
I_PHONE IN USERINFO.PHONE%TYPE,
I_EMAIL IN USERINFO.EMAIL%TYPE)
AS
BEGIN
INSERT INTO USERTABLE VALUES (
ADDUSERSEQ.NEXTVAL,
I_USERNAME, 
I_PASSENCRYPT, 
I_USER_TYPE);
INSERT INTO USERINFO VALUES (
ADDUSERSEQ.CURRVAL,
I_FIRSTNAME,
I_LASTNAME,
I_ADDRESS, 
I_CITY, I_STATE_LOC,
I_PHONE, I_EMAIL);
COMMIT;
END;
/
CREATE OR REPLACE PROCEDURE CREATEACCOUNT (
I_BALANCE IN NUMBER,
I_USER_ID2 IN NUMBER)
AS
BEGIN
INSERT INTO ACCOUNTS VALUES 
(ADDACCOUNTSEQ.NEXTVAL,
I_BALANCE,
I_USER_ID2);
COMMIT;
END;
/
EXECUTE CREATEACCOUNT (736.99,10002);
commit;

sELECT * FROM ACCOUNTs WHERE USER_ID=10002;

CREATE OR REPLACE PROCEDURE UPDATE_ACC_BALANCE (
I_ACC_ID IN NUMBER, I_BALANCE IN NUMBER)
AS
BEGIN
UPDATE ACCOUNTS
SET BALANCE = I_BALANCE
WHERE ACC_ID=I_ACC_ID;
COMMIT;
END;

CREATE OR REPLACE PROCEDURE DELETE_ACCOUNT(I_ACC_ID IN NUMBER)
AS
BEGIN
DELETE FROM ACCOUNTS
WHERE ACC_ID =I_ACC_ID;
COMMIT;
END;
/

CREATE OR REPLACE PROCEDURE UPDATE_PASSWORD (
I_USER_ID IN USERTABLE.USER_ID%TYPE,
I_PASSENCRYPT IN USERTABLE.PASSENCRYPT%TYPE)
AS
BEGIN
UPDATE USERTABLE
SET PASSENCRYPT=I_PASSENCRYPT
WHERE USER_ID = I_USER_ID;
COMMIT;
END;
/

CREATE OR REPLACE PROCEDURE UPDATE_USERINFO (
I_USER_ID IN USERINFO.USER_ID%TYPE,
I_FIRSTNAME IN USERINFO.FIRSTNAME%TYPE,
I_LASTNAME IN USERINFO.LASTNAME%TYPE,
I_ADDRESS IN USERINFO.ADDRESS%TYPE,
I_CITY IN USERINFO.CITY%TYPE,
I_STATE_LOC IN USERINFO.STATE_LOC%TYPE,
I_PHONE IN USERINFO.PHONE%TYPE,
I_EMAIL IN USERINFO.EMAIL%TYPE)
AS
BEGIN
UPDATE USERINFO
SET FIRSTNAME = I_FIRSTNAME,
LASTNAME = I_LASTNAME,
ADDRESS = I_ADDRESS,
CITY = I_CITY,
STATE_LOC = I_STATE_LOC,
PHONE = I_PHONE,
EMAIL = I_EMAIL
WHERE USER_ID=I_USER_ID;
COMMIT;
END;

CREATE OR REPLACE PROCEDURE DELETE_USER(I_USER_ID IN NUMBER)
AS
BEGIN
DELETE FROM USERTABLE
WHERE USER_ID =I_USER_ID;
COMMIT;
END;
/

EXECUTE DELETE_USER(10005);
ALTER TABLE UserInfo DROP CONSTRAINT FK_UserInfoUserId;
ALTER TABLE UserInfo ADD CONSTRAINT FK_UserInfoUserId
    FOREIGN KEY (USER_ID) REFERENCES UserTable (USER_ID)  
    ON DELETE CASCADE;